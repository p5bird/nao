    {# Google MAP API #}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_map_api }}&callback=initMap" async defer></script>

    {# google Map #}
    <script type="text/javascript" title="Google Map">
      
      function initMap() {
        
        var inputLat = $("input[id*='latitude']");
        var inputLng = $("input[id*='longitude']");
        var obsPosition = {lat: 46.52863469527167, lng: 2.43896484375};

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 5
        })

        if (inputLat.val() && inputLng.val())
        {
            obsPosition = {lat: parseFloat(inputLat.val()), lng: parseFloat(inputLng.val())};
            map.setZoom(10);
        } 
        map.setCenter(obsPosition);

        // init obs marker
        var obsMarker = new google.maps.Marker({
          position: obsPosition,
          map: map,
          title: 'votre observation',
          draggable: true,
          animation: google.maps.Animation.DROP
        });

        // option to add marker on the map
        obsMarker.setMap(map);

        // marker animation
        function toggleBounce() {
          if (obsMarker.getAnimation() !== null) {
            obsMarker.setAnimation(null);
          } else {
            obsMarker.setAnimation(google.maps.Animation.BOUNCE);
          }
        }

        // listener on osbMarker dragging
        // to change lat and lng input values
        obsMarker.addListener('position_changed', function(event){
            inputLat.val(obsMarker.getPosition().lat());
            inputLng.val(obsMarker.getPosition().lng());
        });

        obsMarker.addListener('drag', function(event){
            $("input[id*='_place']").val(null);
        });

        var geocoder = new google.maps.Geocoder();

        document.querySelector("input[id*='_place']").addEventListener('input', function() {
          geocodeAddress(geocoder, map, obsMarker);
        });


      }



      function geocodeAddress(geocoder, resultsMap, obsMarker) {
        var address = document.getElementById('observationbundle_observation_place').value;
        geocoder.geocode({
            'address': address,
            'componentRestrictions': {country: 'FR'}}, function(results, status) {
          if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);
           // var marker = new google.maps.Marker({
           //    map: resultsMap,
           //    position: results[0].geometry.location
           //  });
            obsMarker.setMap(resultsMap);
            obsMarker.setPosition(results[0].geometry.location);
          } else {
            console.log('Geocode was not successful for the following reason: ' + status);
          }
        });
      }

    </script>