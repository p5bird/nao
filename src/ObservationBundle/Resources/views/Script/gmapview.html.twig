    {# Google MAP API #}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_map_api }}&callback=initMap" async defer></script>

    {# google Map #}
    <script type="text/javascript" title="Google Map">
    
      var infowindow;

      function initMap() {
        
        // Center of France Position : {lat: 46.52863469527167, lng: 2.43896484375}
        var centerFrancePosition = {lat: 46.52863469527167, lng: 2.43896484375};
        var obsPosition = centerFrancePosition;


        // initilize the map
        var map = new google.maps.Map(document.getElementById('map'), {
          center: obsPosition,
          zoom: 5,
          // map types : roadmap, satellite, hybrid, terrain
          mapTypeId: 'roadmap'
        })

        // Trying to geolocalize user to center marker and map near user location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            obsPosition = {lat: position.coords.latitude, lng: position.coords.longitude};
            obsMarker.setPosition(obsPosition);
            map.setCenter(obsPosition);
          }, function() {
            console.log('Error: The Geolocation service failed.');
          });
        } else {
          console.log('Error: Your browser doesn\'t support geolocation.');
        }

        // Geocoder to move marker on typed address (find geoloc datas)
        var geocoder = new google.maps.Geocoder();

        document.querySelector("input[id*='_place']").addEventListener('input', function() {
          if (this.value.length > 2)
          {
            geocodeAddress(geocoder, map);
          }
        });

        document.getElementById("centerMapFrance").addEventListener('click', function() {
          map.setCenter(centerFrancePosition);
          map.setZoom(5);
          $("input[id*='_place']").val(null);
        });

        infowindow = new google.maps.InfoWindow();

        var obsJson = {{ obsJson|raw }};
        addMarkers(obsJson, map);
        
        // $.ajax({
        //     url: "{{ path('nao_ajax_obs_list') }}",
        //     dataType: 'json',
        //     success: function(obsList){
        //         addMarkers(obsList, map);
        //     }
        // });

        // $('.gmarker').hover(function(e) {
          
        //   for(var i= 0; i < markers.length; i++)
        //   {
        //       markers[i].setMap(null);
        //       console.log(markers[i].id);
        //       console.log(this.getAttribute('gmarker'));
        //      if (markers[i].id = this.getAttribute('gmarker'))
        //      {
        //         markers[i].setMap(map);
        //         //map.setCenter(parseFloat(markers[i].lat), parseFloat(markers[i].lng));
        //         map.setZoom(5); 
        //      }   
        //   }
        // });

      }
      var markers;
    
        function addMarkers(obsList, map) {
            markers = obsList.map(function(obs, i) {
              var marker = new google.maps.Marker({
                lat: parseFloat(obsList[i].latitude),
                lng: parseFloat(obsList[i].longitude),
                position: {lat: parseFloat(obsList[i].latitude), lng: parseFloat(obsList[i].longitude)},
                title: obsList[i].birdName,
                url: obsList[i].url,
                id: obsList[i].id
              });
                google.maps.event.addListener(marker, 'click', function() {
                    window.location.href = this.url;
                });
                return marker;
            });

            // Setting markerCluster Options
            var clusterStyles = [
            {
              textColor: 'white',
              url: "{{ asset('/img/smallclusterimagex40.png') }}",
              height: 40,
              width: 40
            },
            {
              textColor: 'white',
              url: "{{ asset('/img/smallclusterimagex50.png') }}",
              height: 50,
              width: 50
            },
            {
              textColor: 'white',
              url: "{{ asset('/img/smallclusterimagex60.png') }}",
              height: 60,
              width: 60
            }
          ];

            // Add a marker clusterer to manage the markers.
            var markerCluster = new MarkerClusterer(map, markers,
                {styles: clusterStyles});
        }



      function geocodeAddress(geocoder, resultsMap) {
        var address = document.querySelector("input[id*='_place']").value;
        geocoder.geocode({
            'address': address,
            'region': 'fr'
            // 'componentRestrictions': {country: 'FR'}
            }, function(results, status) {
          if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);
            resultsMap.setZoom(10);
          } else {
            console.log('Geocode was not successful for the following reason: ' + status);
          }
        });
      }

    </script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
    </script>