    {# Google MAP API #}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_map_api }}&callback=initMap" async defer></script>

    {# google Map #}
    <script type="text/javascript" title="Google Map">
    
      function initMap() {
        
        // Center of France Position : {lat: 46.52863469527167, lng: 2.43896484375}
        var obsPosition = {lat: 46.52863469527167, lng: 2.43896484375};


        // initilize the map
        var map = new google.maps.Map(document.getElementById('map'), {
          center: obsPosition,
          zoom: 5
        })

        // Trying to geolocalize user to center marker and map near user location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            obsPosition = {lat: position.coords.latitude, lng: position.coords.longitude};
            obsMarker.setPosition(obsPosition);
            map.setCenter(obsPosition);
          }, function() {
            console.log('Error: The Geolocation service failed.');
          });
        } else {
          console.log('Error: Your browser doesn\'t support geolocation.');
        }


        // Geocoder to move marker on typed address (find geoloc datas)
        var geocoder = new google.maps.Geocoder();

        document.querySelector("input[id*='_place']").addEventListener('input', function() {
          geocodeAddress(geocoder, map);
        });

        $.ajax({
            url: "{{ path('nao_ajax_obs_list') }}",
            dataType: 'json',
            success: function(obsList){
                addMarkers(obsList, map);
            }
        });


      }
    
        function addMarkers(obsList, map) {
            var markers = obsList.map(function(obs, i) {
              var marker = new google.maps.Marker({
                position: {lat: parseFloat(obsList[i].latitude), lng: parseFloat(obsList[i].longitude)},
                title: obsList[i].birdName,
                url: obsList[i].url
              });
                google.maps.event.addListener(marker, 'click', function() {
                    window.location.href = this.url;
                });
                return marker;
            });

            // Add a marker clusterer to manage the markers.
            var markerCluster = new MarkerClusterer(map, markers,
                {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
        }



      function geocodeAddress(geocoder, resultsMap) {
        var address = document.getElementById('observationbundle_observation_place').value;
        geocoder.geocode({
            'address': address,
            'region': 'fr'
            // 'componentRestrictions': {country: 'FR'}
            }, function(results, status) {
          if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);
          } else {
            console.log('Geocode was not successful for the following reason: ' + status);
          }
        });
      }

    </script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
    </script>